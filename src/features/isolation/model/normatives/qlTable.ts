import {
  interpolate2DDecimal,
  type BilinearInterpolationResult,
  type Table2D,
} from "@/shared/model/calcualteBilinearInterpolation";
import type { Decimal } from "decimal.js";

const QL_TABLE: Table2D = {
  x: [
    15, 20, 25, 40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 450,
    500, 600, 700, 800, 900, 1000, 1400,
  ],
  y: [20, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600],
  values: [
    [4, 9, 17, 25, 35, 45, 56, 68, 81, 94, 109, 124, 140],
    [4, 10, 19, 28, 39, 50, 62, 75, 89, 103, 119, 135, 152],
    [5, 11, 20, 31, 42, 54, 67, 81, 95, 111, 128, 145, 163],
    [5, 12, 23, 35, 47, 60, 75, 90, 106, 123, 142, 161, 181],
    [6, 14, 26, 38, 51, 66, 81, 98, 115, 133, 153, 173, 195],
    [7, 16, 29, 43, 58, 74, 90, 108, 127, 147, 169, 191, 214],
    [8, 17, 31, 46, 62, 78, 96, 115, 135, 156, 179, 202, 226],
    [9, 19, 34, 50, 67, 85, 104, 124, 146, 168, 192, 217, 243],
    [10, 21, 38, 55, 74, 93, 114, 136, 159, 183, 208, 235, 263],
    [11, 23, 42, 61, 80, 101, 132, 156, 182, 209, 238, 267],
    [14, 28, 50, 72, 95, 119, 154, 182, 212, 242, 274, 308, 343],
    [16, 33, 57, 82, 107, 133, 173, 204, 236, 270, 305, 342, 380],
    [18, 37, 64, 91, 118, 147, 191, 224, 259, 296, 333, 373, 414],
    [22, 45, 77, 108, 140, 173, 208, 244, 281, 320, 361, 403, 446],
    [25, 49, 84, 117, 152, 187, 223, 262, 301, 343, 385, 430, 476],
    [27, 54, 91, 127, 163, 200, 239, 280, 322, 365, 410, 457, 505],
    [30, 58, 98, 136, 175, 215, 256, 299, 343, 389, 436, 486, 537],
    [34, 67, 112, 154, 197, 241, 286, 333, 382, 432, 484, 537, 593],
    [38, 75, 124, 170, 217, 264, 313, 364, 416, 470, 526, 583, 642],
    [43, 83, 137, 188, 238, 290, 343, 397, 453, 511, 571, 633, 696],
    [47, 91, 150, 205, 259, 315, 372, 430, 490, 552, 616, 681, 749],
    [52, 100, 163, 222, 281, 340, 400, 463, 527, 592, 660, 729, 801],
    [70, 133, 215, 291, 364, 439, 514, 591, 670, 750, 833, 918, 1098],
  ],
};

export function getQl(
  pipe_diameter: number | null,
  tAvg: Decimal | null
): BilinearInterpolationResult | null {
  if (!pipe_diameter || !tAvg) {
    return null;
  }
  return interpolate2DDecimal(QL_TABLE, pipe_diameter, tAvg);
}
